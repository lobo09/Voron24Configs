[gcode_macro MOVE_OVER_PURGE_BUCKET]
variable_lift_distance: 2
gcode:
  SAVE_GCODE_STATE NAME=MOVE_OVER_PURGE_BUCKET
  
  {% if "x" not in printer.toolhead.homed_axes or "y" not in printer.toolhead.homed_axes %}
   G28 X Y
  {% endif %}

  
  {% if "z"  in printer.toolhead.homed_axes %}                                               ; if z is homed, move up a little
    G91                                                                                      ; relative mode
    {% if (printer.toolhead.position.z + lift_distance) < printer.toolhead.axis_maximum.z %}
      G0 Z{lift_distance}
    {% else %}
      G0 Z{printer.toolhead.axis_maximum.z}
    {% endif %}
  {% endif %}
  
  G90                                                                                        ; absolute mode
  G0 X290 Y300  F9000                                                                        ; go to purge bucket
                                             
  M400                                                                                       ; wait until all moves are finished
  RESTORE_GCODE_STATE NAME=MOVE_OVER_PURGE_BUCKET